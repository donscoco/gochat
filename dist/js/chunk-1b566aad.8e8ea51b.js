(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1b566aad"],{2859:function(e,t,i){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"group-member"},[t("head-image",{attrs:{url:e.member.headImage,size:50,id:e.member.userId}},[e.showDel?t("div",{staticClass:"btn-kick el-icon-error",on:{click:function(t){return t.stopPropagation(),e.handleDelete()}}}):e._e()]),t("div",{staticClass:"member-name"},[e._v(e._s(e.member.aliasName))])],1)},a=[],r=i("4036"),o={name:"groupMember",components:{HeadImage:r["a"]},data(){return{}},props:{member:{type:Object,required:!0},showDel:{type:Boolean,default:!1}},methods:{handleDelete(){this.$emit("del",this.member)}}},n=o,l=(i("de5e"),i("2877")),c=Object(l["a"])(n,s,a,!1,null,null,null);t["a"]=c.exports},"289b":function(e,t,i){},2989:function(e,t,i){},"35fb":function(e,t,i){"use strict";i("289b")},"3db1":function(e,t,i){},4177:function(e,t,i){},4841:function(e,t,i){},"5c36":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"im-group-box"},[t("el-aside",{staticClass:"l-group-box",attrs:{width:"250px"}},[t("div",{staticClass:"l-group-header"},[t("div",{staticClass:"l-group-search"},[t("el-input",{attrs:{width:"200px",placeholder:"搜索群聊"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},slot:"append"})],1)],1),t("el-button",{staticStyle:{border:"none",padding:"12px","font-size":"20px",color:"black"},attrs:{plain:"",icon:"el-icon-plus",title:"创建群聊"},on:{click:function(t){return e.handleCreateGroup()}}})],1),t("el-scrollbar",{staticClass:"l-group-list"},e._l(e.groupStore.groups,(function(i,s){return t("div",{key:s},[t("group-item",{directives:[{name:"show",rawName:"v-show",value:i.remark.startsWith(e.searchText),expression:"group.remark.startsWith(searchText)"}],attrs:{group:i,active:s===e.groupStore.activeIndex},nativeOn:{click:function(t){return e.handleActiveItem(i,s)}}})],1)})),0)],1),t("el-container",{staticClass:"r-group-box"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.activeGroup.id,expression:"activeGroup.id"}],staticClass:"r-group-header"},[e._v(" "+e._s(e.activeGroup.remark)+"("+e._s(e.groupMembers.length)+") ")]),t("el-scrollbar",{staticClass:"r-group-container"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.activeGroup.id,expression:"activeGroup.id"}]},[t("div",{staticClass:"r-group-info"},[t("div",[t("file-upload",{staticClass:"avatar-uploader",attrs:{action:e.imageAction,disabled:!e.isOwner,showLoading:!0,maxSize:e.maxSize,fileTypes:["image/jpeg","image/png","image/jpg","image/webp"]},on:{success:e.handleUploadSuccess}},[e.activeGroup.headImage?t("img",{staticClass:"avatar",attrs:{src:e.activeGroup.headImage}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),t("el-button",{staticClass:"send-btn",on:{click:function(t){return e.handleSendMessage()}}},[e._v("发送消息")])],1),t("el-form",{ref:"groupForm",staticClass:"r-group-form",attrs:{"label-width":"130px",model:e.activeGroup,rules:e.rules}},[t("el-form-item",{attrs:{label:"群聊名称",prop:"name"}},[t("el-input",{attrs:{disabled:!e.isOwner,maxlength:"20"},model:{value:e.activeGroup.name,callback:function(t){e.$set(e.activeGroup,"name",t)},expression:"activeGroup.name"}})],1),t("el-form-item",{attrs:{label:"群主"}},[t("el-input",{attrs:{value:e.ownerName,disabled:""}})],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{placeholder:"群聊的备注仅自己可见",maxlength:"20"},model:{value:e.activeGroup.remark,callback:function(t){e.$set(e.activeGroup,"remark",t)},expression:"activeGroup.remark"}})],1),t("el-form-item",{attrs:{label:"我在本群的昵称"}},[t("el-input",{attrs:{placeholder:"",maxlength:"20"},model:{value:e.activeGroup.aliasName,callback:function(t){e.$set(e.activeGroup,"aliasName",t)},expression:"activeGroup.aliasName"}})],1),t("el-form-item",{attrs:{label:"群公告"}},[t("el-input",{attrs:{disabled:!e.isOwner,type:"textarea",maxlength:"1024",placeholder:"群主未设置"},model:{value:e.activeGroup.notice,callback:function(t){e.$set(e.activeGroup,"notice",t)},expression:"activeGroup.notice"}})],1),t("div",{staticClass:"btn-group"},[t("el-button",{attrs:{type:"success"},on:{click:function(t){return e.handleSaveGroup()}}},[e._v("提交")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isOwner,expression:"!isOwner"}],attrs:{type:"danger"},on:{click:function(t){return e.handleQuit()}}},[e._v("退出群聊")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isOwner,expression:"isOwner"}],attrs:{type:"danger"},on:{click:function(t){return e.handleDissolve()}}},[e._v("解散群聊")])],1)],1)],1),t("el-divider",{attrs:{"content-position":"center"}}),t("el-scrollbar",{staticStyle:{height:"400px"}},[t("div",{staticClass:"r-group-member-list"},[e._l(e.groupMembers,(function(i){return t("div",{key:i.id},[t("group-member",{directives:[{name:"show",rawName:"v-show",value:!i.quit,expression:"!member.quit"}],staticClass:"r-group-member",attrs:{member:i,showDel:e.isOwner&&i.userId!=e.activeGroup.ownerId},on:{del:e.handleKick}})],1)})),t("div",{staticClass:"r-group-invite"},[t("div",{staticClass:"invite-member-btn",attrs:{title:"邀请好友进群聊"},on:{click:function(t){return e.handleInviteMember()}}},[t("i",{staticClass:"el-icon-plus"})]),t("div",{staticClass:"invite-member-text"},[e._v("邀请")]),t("add-group-member",{attrs:{visible:e.showAddGroupMember,groupId:e.activeGroup.id,members:e.groupMembers},on:{reload:e.loadGroupMembers,close:e.handleCloseAddGroupMember}})],1)],2)])],1)])],1)],1)},a=[],r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"item",class:e.active?"active":""},[t("div",{staticClass:"avatar"},[t("head-image",{attrs:{url:e.group.headImage}})],1),t("div",{staticClass:"text"},[t("div",[e._v(e._s(e.group.remark))])])])},o=[],n=i("4036"),l={name:"groupItem",components:{HeadImage:n["a"]},data(){return{}},props:{group:{type:Object},active:{type:Boolean}}},c=l,u=(i("d58d"),i("2877")),d=Object(u["a"])(c,r,o,!1,null,null,null),p=d.exports,h=i("1a05"),m=i("2859"),v=i("b242"),f={name:"group",components:{GroupItem:p,GroupMember:m["a"],FileUpload:h["a"],AddGroupMember:v["a"]},data(){return{searchText:"",maxSize:5242880,activeGroup:{},groupMembers:[],showAddGroupMember:!1,rules:{name:[{required:!0,message:"请输入群聊名称",trigger:"blur"}]}}},methods:{handleCreateGroup(){this.$prompt("请输入群聊名称","创建群聊",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"请输入群聊名称"}).then(e=>{this.$http({url:"/group/create?groupName="+e.value,method:"post"}).then(e=>{this.$store.commit("addGroup",e)})})},handleActiveItem(e,t){this.$store.commit("activeGroup",t),this.activeGroup=JSON.parse(JSON.stringify(e)),this.loadGroupMembers()},handleInviteMember(){this.showAddGroupMember=!0},handleCloseAddGroupMember(){this.showAddGroupMember=!1},handleUploadSuccess(e){this.activeGroup.headImage=e.data.originUrl,this.activeGroup.headImageThumb=e.data.thumbUrl},handleSaveGroup(){this.$refs["groupForm"].validate(e=>{if(e){let e=this.activeGroup;this.$http({url:"/group/modify",method:"put",data:e}).then(e=>{this.$store.commit("updateGroup",e),this.$message.success("修改成功")})}})},handleDissolve(){this.$confirm("确认要解散群聊吗?","确认解散?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$http({url:"/group/delete/"+this.activeGroup.id,method:"delete"}).then(()=>{this.$message.success(`群聊'${this.activeGroup.name}'已解散`),this.$store.commit("removeGroup",this.activeGroup.id),this.$store.commit("activeGroup",-1),this.$store.commit("removeGroupChat",this.activeGroup.id),this.activeGroup={}})})},handleKick(e){this.$confirm(`确定将成员'${e.aliasName}'移出群聊吗？`,"确认移出?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$http({url:"/group/kick/"+this.activeGroup.id,method:"delete",params:{userId:e.userId}}).then(()=>{this.$message.success(`已将${e.aliasName}移出群聊`),e.quit=!0})})},handleQuit(){this.$confirm("退出群聊后将不再接受群里的消息，确认退出吗？","确认退出?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$http({url:"/group/quit/"+this.activeGroup.id,method:"delete"}).then(()=>{this.$store.commit("removeGroup",this.activeGroup.id),this.$store.commit("activeGroup",-1),this.$store.commit("removeGroupChat",this.activeGroup.id)})})},handleSendMessage(){let e={type:"GROUP",targetId:this.activeGroup.id,showName:this.activeGroup.remark,headImage:this.activeGroup.headImage};this.$store.commit("openChat",e),this.$store.commit("activeChat",0),this.$router.push("/home/chat")},loadGroupMembers(){this.$http({url:"/group/members/"+this.activeGroup.id,method:"get"}).then(e=>{this.groupMembers=e})}},computed:{groupStore(){return this.$store.state.groupStore},ownerName(){let e=this.groupMembers.find(e=>e.userId==this.activeGroup.ownerId);return e&&e.aliasName},isOwner(){return this.activeGroup.ownerId==this.$store.state.userStore.userInfo.id},imageAction(){return"/api/image/upload"}},mounted(){if(this.groupStore.activeIndex>=0){let e=this.groupStore.groups[this.groupStore.activeIndex];this.activeGroup=JSON.parse(JSON.stringify(e)),this.loadGroupMembers()}}},b=f,g=(i("7721"),Object(u["a"])(b,s,a,!1,null,null,null));t["default"]=g.exports},7721:function(e,t,i){"use strict";i("3db1")},ae09:function(e,t,i){"use strict";i("4177")},b242:function(e,t,i){"use strict";var s=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"邀请好友",visible:e.visible,width:"50%","before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"agm-container"},[t("div",{staticClass:"agm-l-box"},[t("el-input",{staticClass:"input-with-select",attrs:{width:"200px",placeholder:"搜索好友"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch()}},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.handleSearch()}},slot:"append"})],1),t("el-scrollbar",{staticStyle:{height:"400px"}},e._l(e.friends,(function(i,s){return t("div",{key:i.id},[t("friend-item",{directives:[{name:"show",rawName:"v-show",value:i.nickName.startsWith(e.searchText),expression:"friend.nickName.startsWith(searchText)"}],attrs:{showDelete:!1,friend:i,index:s,active:s===e.activeIndex},nativeOn:{click:function(t){return e.handleSwitchCheck(i)}}},[t("el-checkbox",{staticClass:"agm-friend-checkbox",attrs:{disabled:i.disabled,size:"medium"},nativeOn:{click:function(e){e.stopPropagation()}},model:{value:i.isCheck,callback:function(t){e.$set(i,"isCheck",t)},expression:"friend.isCheck"}})],1)],1)})),0)],1),t("div",{staticClass:"agm-r-box"},[t("div",{staticClass:"agm-select-tip"},[e._v(" 已勾选"+e._s(e.checkCount)+"位好友")]),t("el-scrollbar",{staticStyle:{height:"400px"}},e._l(e.friends,(function(i,s){return t("div",{key:i.id},[i.isCheck&&!i.disabled?t("friend-item",{attrs:{friend:i,index:s,active:!1},on:{del:function(t){return e.handleRemoveFriend(i,s)}}}):e._e()],1)})),0)],1)]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.handleClose()}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleOk()}}},[e._v("确 定")])],1)])},a=[],r=i("ff36"),o={name:"addGroupMember",components:{FriendItem:r["a"]},data(){return{searchText:"",activeIndex:-1,friends:[]}},methods:{handleClose(){this.$emit("close")},handleOk(){let e={groupId:this.groupId,friendIds:[]};this.friends.forEach(t=>{t.isCheck&&!t.disabled&&e.friendIds.push(t.id)}),e.friendIds.length>0&&this.$http({url:"/group/invite",method:"post",data:e}).then(()=>{this.$message.success("邀请成功"),this.$emit("reload"),this.$emit("close")})},handleRemoveFriend(e,t){e.isCheck=!1},handleSwitchCheck(e){e.disabled||(e.isCheck=!e.isCheck)}},props:{visible:{type:Boolean},groupId:{type:Number},members:{type:Array}},computed:{checkCount(){return this.friends.filter(e=>e.isCheck&&!e.disabled).length}},watch:{visible:function(e,t){e&&(this.friends=[],this.$store.state.friendStore.friends.forEach(e=>{let t=JSON.parse(JSON.stringify(e)),i=this.members.filter(e=>!e.quit).find(t=>t.userId==e.id);console.log(i),i?(t.disabled=!0,t.isCheck=!0):(t.disabled=!1,t.isCheck=!1),this.friends.push(t)}))}}},n=o,l=(i("ae09"),i("2877")),c=Object(l["a"])(n,s,a,!1,null,null,null);t["a"]=c.exports},d58d:function(e,t,i){"use strict";i("2989")},de5e:function(e,t,i){"use strict";i("4841")},ff36:function(e,t,i){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"friend-item",class:e.active?"active":""},[t("div",{staticClass:"avatar"},[t("head-image",{attrs:{url:e.friend.headImage}})],1),t("div",{staticClass:"text"},[t("div",[e._v(e._s(e.friend.nickName))]),t("div",{class:e.online?"online-status  online":"online-status"},[e._v(e._s(e.online?"[在线]":"[离线]"))])]),e.showDelete?t("div",{staticClass:"close",on:{click:function(t){return t.stopPropagation(),e.handleDel()}}},[t("i",{staticClass:"el-icon-close",staticStyle:{border:"none","font-size":"20px",color:"black"},attrs:{title:"添加好友"}})]):e._e(),e._t("default")],2)},a=[],r=i("4036"),o={name:"frinedItem",components:{HeadImage:r["a"]},data(){return{}},methods:{handleDel(){console.log("11111111111111111111"),this.$emit("del",this.friend,this.index)}},props:{friend:{type:Object},active:{type:Boolean},index:{type:Number},showDelete:{type:Boolean,default:!0}},computed:{online(){return this.$store.state.friendStore.friends[this.index].online}}},n=o,l=(i("35fb"),i("2877")),c=Object(l["a"])(n,s,a,!1,null,null,null);t["a"]=c.exports}}]);
//# sourceMappingURL=chunk-1b566aad.8e8ea51b.js.map