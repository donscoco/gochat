(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3420c764"],{"0b3c":function(e,t,s){"use strict";s("1d27")},"1d27":function(e,t,s){},2859:function(e,t,s){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"group-member"},[t("head-image",{attrs:{url:e.member.headImage,size:50,id:e.member.userId}},[e.showDel?t("div",{staticClass:"btn-kick el-icon-error",on:{click:function(t){return t.stopPropagation(),e.handleDelete()}}}):e._e()]),t("div",{staticClass:"member-name"},[e._v(e._s(e.member.aliasName))])],1)},n=[],a=s("4036"),o={name:"groupMember",components:{HeadImage:a["a"]},data(){return{}},props:{member:{type:Object,required:!0},showDel:{type:Boolean,default:!1}},methods:{handleDelete(){this.$emit("del",this.member)}}},r=o,l=(s("de5e"),s("2877")),c=Object(l["a"])(r,i,n,!1,null,null,null);t["a"]=c.exports},"289b":function(e,t,s){},3270:function(e,t,s){},"35fb":function(e,t,s){"use strict";s("289b")},3646:function(e,t,s){},"3f94":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("el-container",[t("el-aside",{staticClass:"l-chat-box",attrs:{width:"250px"}},[t("div",{staticClass:"l-chat-header"},[t("el-input",{attrs:{width:"200px",placeholder:"搜索"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},slot:"append"})],1)],1),t("el-scrollbar",{staticClass:"l-chat-list"},e._l(e.chatStore.chats,(function(s,i){return t("div",{key:i},[t("chat-item",{attrs:{chat:s,index:i,active:i===e.chatStore.activeIndex},on:{del:function(t){return e.handleDelItem(s,i)}},nativeOn:{click:function(t){return e.handleActiveItem(i)}}})],1)})),0)],1),t("el-container",{staticClass:"r-chat-box"},[t("chat-box",{directives:[{name:"show",rawName:"v-show",value:e.activeChat.targetId>0,expression:"activeChat.targetId>0"}],attrs:{chat:e.activeChat}})],1)],1)},n=[],a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"chat-item",class:e.active?"active":""},[t("div",{staticClass:"left"},[t("head-image",{attrs:{url:e.chat.headImage,size:40,id:"PRIVATE"==e.chat.type?e.chat.targetId:0}}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.chat.unreadCount>0,expression:"chat.unreadCount>0"}],staticClass:"unread-text"},[e._v(e._s(e.chat.unreadCount))])],1),t("div",{staticClass:"mid"},[t("div",[e._v(e._s(e.chat.showName))]),t("div",{staticClass:"msg-text",domProps:{innerHTML:e._s(e.$emo.transform(e.chat.lastContent))}})]),t("div",{staticClass:"right"},[t("div",{on:{click:function(t){return t.stopPropagation(),e.onClickClose()}}},[t("i",{staticClass:"el-icon-close close",staticStyle:{border:"none","font-size":"20px",color:"black"},attrs:{title:"关闭"}})]),t("div",{staticClass:"msg-time"},[t("chat-time",{attrs:{time:e.chat.lastSendTime}})],1)])])},o=[],r=function(){var e=this,t=e._self._c;return t("span",[e._v(e._s(e.formatDate))])},l=[],c={name:"chatTime",data(){return{}},props:{time:{type:Number}},computed:{formatDate(){let e=new Date(this.time),t="",s=new Date;s.setHours(0,0,0,0);let i=Math.floor((s.getTime()-e.getTime())/864e5);return e.getTime()>s.getTime()?(t=e.getHours()<=9?"0"+e.getHours():e.getHours(),t+=":",t+=e.getMinutes()<=9?"0"+e.getMinutes():e.getMinutes()):t=i<1?"昨天":i<7?i+1+"天前":e.getMonth()+1+"月"+e.getDate()+"日",t}}},d=c,u=s("2877"),h=Object(u["a"])(d,r,l,!1,null,null,null),m=h.exports,p=s("4036"),f={name:"chatItem",components:{ChatTime:m,HeadImage:p["a"]},data(){return{}},props:{chat:{type:Object},active:{type:Boolean},index:{type:Number}},methods:{onClickClose(){this.$emit("del")}}},g=f,v=(s("b557"),Object(u["a"])(g,a,o,!1,null,null,null)),y=v.exports,w=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"chat-box"},[t("el-header",{attrs:{height:"60px"}},[t("span",[e._v(e._s(e.title))]),t("span",{directives:[{name:"show",rawName:"v-show",value:"GROUP"==this.chat.type,expression:"this.chat.type=='GROUP'"}],staticClass:"btn-side el-icon-more",attrs:{title:"群聊信息"},on:{click:function(t){e.showSide=!e.showSide}}})]),t("el-main",{staticStyle:{padding:"0"}},[t("el-container",[t("el-container",{staticClass:"content-box"},[t("el-main",{staticClass:"im-chat-main",attrs:{id:"chatScrollBox"}},[t("div",{staticClass:"im-chat-box"},[t("ul",e._l(e.chat.messages,(function(s,i){return t("li",{key:i},[t("chat-message-item",{attrs:{mine:s.sendId==e.mine.id,headImage:e.headImage(s),showName:e.showName(s),msgInfo:s},on:{delete:e.deleteMessage,recall:e.recallMessage}})],1)})),0)])]),t("el-footer",{staticClass:"im-chat-footer",attrs:{height:"200px"}},[t("div",{staticClass:"chat-tool-bar"},[t("div",{ref:"emotion",staticClass:"icon iconfont icon-biaoqing",attrs:{title:"表情"},on:{click:function(t){return e.switchEmotionBox()}}}),t("div",{attrs:{title:"发送图片"}},[t("file-upload",{attrs:{action:e.imageAction,maxSize:5242880,fileTypes:["image/jpeg","image/png","image/jpg","image/webp","image/gif"]},on:{before:e.handleImageBefore,success:e.handleImageSuccess,fail:e.handleImageFail}},[t("i",{staticClass:"el-icon-picture-outline"})])],1),t("div",{attrs:{title:"发送文件"}},[t("file-upload",{attrs:{action:e.fileAction,maxSize:10485760},on:{before:e.handleFileBefore,success:e.handleFileSuccess,fail:e.handleFileFail}},[t("i",{staticClass:"el-icon-wallet"})])],1),t("div",{staticClass:"el-icon-microphone",attrs:{title:"发送语音"},on:{click:function(t){return e.showVoiceBox()}}}),t("div",{directives:[{name:"show",rawName:"v-show",value:"PRIVATE"==e.chat.type,expression:"chat.type=='PRIVATE'"}],staticClass:"el-icon-phone-outline",attrs:{title:"视频聊天"},on:{click:function(t){return e.showVideoBox()}}}),t("div",{staticClass:"el-icon-chat-dot-round",attrs:{title:"聊天记录"},on:{click:function(t){return e.showHistoryBox()}}})]),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.sendText,expression:"sendText"}],ref:"sendBox",staticClass:"send-text-area",attrs:{disabled:e.lockMessage},domProps:{value:e.sendText},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.sendTextMessage()},input:function(t){t.target.composing||(e.sendText=t.target.value)}}}),t("div",{staticClass:"im-chat-send"},[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.sendTextMessage()}}},[e._v("发送")])],1)])],1),t("el-aside",{directives:[{name:"show",rawName:"v-show",value:e.showSide,expression:"showSide"}],staticClass:"chat-group-side-box",attrs:{width:"300px"}},[t("chat-group-side",{attrs:{group:e.group,groupMembers:e.groupMembers},on:{reload:function(t){return e.loadGroup(e.group.id)}}})],1)],1)],1),t("emotion",{directives:[{name:"show",rawName:"v-show",value:e.showEmotion,expression:"showEmotion"}],attrs:{pos:e.emoBoxPos},on:{emotion:e.handleEmotion}}),t("chat-voice",{attrs:{visible:e.showVoice},on:{close:e.closeVoiceBox,send:e.handleSendVoice}}),t("chat-history",{attrs:{visible:e.showHistory,chat:e.chat,friend:e.friend,group:e.group,groupMembers:e.groupMembers},on:{close:e.closeHistoryBox}})],1)},b=[],x=function(){var e=this,t=e._self._c;return t("div",{staticClass:"chat-group-side"},[t("div",{staticClass:"group-side-search"},[t("el-input",{attrs:{placeholder:"搜索群成员"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},slot:"append"})],1)],1),t("el-scrollbar",{staticClass:"group-side-scrollbar"},[t("div",{staticClass:"group-side-member-list"},[t("div",{staticClass:"group-side-invite"},[t("div",{staticClass:"invite-member-btn",attrs:{title:"邀请好友进群聊"},on:{click:function(t){e.showAddGroupMember=!0}}},[t("i",{staticClass:"el-icon-plus"})]),t("div",{staticClass:"invite-member-text"},[e._v("邀请")]),t("add-group-member",{attrs:{visible:e.showAddGroupMember,groupId:e.group.id,members:e.groupMembers},on:{reload:function(t){return e.$emit("reload")},close:function(t){e.showAddGroupMember=!1}}})],1),e._l(e.groupMembers,(function(s){return t("div",{key:s.id},[t("group-member",{directives:[{name:"show",rawName:"v-show",value:!s.quit&&s.aliasName.startsWith(e.searchText),expression:"!member.quit && member.aliasName.startsWith(searchText)"}],staticClass:"group-side-member",attrs:{member:s,showDel:!1}})],1)}))],2),t("el-divider",{attrs:{"content-position":"center"}}),t("el-form",{staticClass:"group-side-form",attrs:{labelPosition:"top",model:e.group}},[t("el-form-item",{attrs:{label:"群聊名称"}},[t("el-input",{attrs:{disabled:"",maxlength:"20"},model:{value:e.group.name,callback:function(t){e.$set(e.group,"name",t)},expression:"group.name"}})],1),t("el-form-item",{attrs:{label:"群主"}},[t("el-input",{attrs:{value:e.ownerName,disabled:""}})],1),t("el-form-item",{attrs:{label:"群公告"}},[t("el-input",{attrs:{disabled:"",type:"textarea",maxlength:"1024",placeholder:"群主未设置"},model:{value:e.group.notice,callback:function(t){e.$set(e.group,"notice",t)},expression:"group.notice"}})],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{disabled:!e.editing,placeholder:"群聊的备注仅自己可见",maxlength:"20"},model:{value:e.group.remark,callback:function(t){e.$set(e.group,"remark",t)},expression:"group.remark"}})],1),t("el-form-item",{attrs:{label:"我在本群的昵称"}},[t("el-input",{attrs:{disabled:!e.editing,placeholder:"xx",maxlength:"20"},model:{value:e.group.aliasName,callback:function(t){e.$set(e.group,"aliasName",t)},expression:"group.aliasName"}})],1),t("div",{staticClass:"btn-group"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:e.editing,expression:"editing"}],attrs:{type:"success"},on:{click:function(t){return e.handleSaveGroup()}}},[e._v("提交")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.editing,expression:"!editing"}],attrs:{type:"primary"},on:{click:function(t){e.editing=!e.editing}}},[e._v("编辑")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isOwner,expression:"!isOwner"}],attrs:{type:"danger"},on:{click:function(t){return e.handleQuit()}}},[e._v("退出群聊")])],1)],1)],1)],1)},C=[],I=s("b242"),S=s("2859"),M={name:"chatGroupSide",components:{AddGroupMember:I["a"],GroupMember:S["a"]},data(){return{searchText:"",editing:!1,showAddGroupMember:!1}},props:{group:{type:Object},groupMembers:{type:Array}},methods:{handleClose(){this.$emit("close")},loadGroupMembers(){this.$http({url:"/group/members/"+this.group.id,method:"get"}).then(e=>{this.groupMembers=e})},handleSaveGroup(){let e=this.group;this.$http({url:"/group/modify",method:"put",data:e}).then(e=>{this.$store.commit("updateGroup",e),this.$emit("reload"),this.$message.success("修改成功")})},handleQuit(){this.$confirm("退出群聊后将不再接受群里的消息，确认退出吗？","确认退出?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$http({url:"/group/quit/"+this.group.id,method:"delete"}).then(()=>{this.$store.commit("removeGroup",this.group.id),this.$store.commit("activeGroup",-1),this.$store.commit("removeGroupChat",this.group.id)})})}},computed:{ownerName(){let e=this.groupMembers.find(e=>e.userId==this.group.ownerId);return e&&e.aliasName},isOwner(){return this.group.ownerId==this.$store.state.userStore.userInfo.id}}},k=M,T=(s("0b3c"),Object(u["a"])(k,x,C,!1,null,null,null)),_=T.exports,P=function(){var e=this,t=e._self._c;return t("div",{staticClass:"chat-msg-item"},[t("div",{directives:[{name:"show",rawName:"v-show",value:10==e.msgInfo.type,expression:"msgInfo.type==10"}],staticClass:"chat-msg-tip"},[e._v(e._s(e.msgInfo.content))]),t("div",{directives:[{name:"show",rawName:"v-show",value:10!=e.msgInfo.type,expression:"msgInfo.type!=10"}],staticClass:"chat-msg-normal",class:{"chat-msg-mine":e.mine}},[t("div",{staticClass:"head-image"},[t("head-image",{attrs:{url:e.headImage,id:e.msgInfo.sendId}})],1),t("div",{staticClass:"chat-msg-content"},[t("div",{staticClass:"chat-msg-top"},[t("span",[e._v(e._s(e.showName))]),t("chat-time",{attrs:{time:e.msgInfo.sendTime}})],1),t("div",{staticClass:"chat-msg-bottom",on:{contextmenu:function(t){return t.preventDefault(),e.showRightMenu(t)}}},[0==e.msgInfo.type?t("span",{staticClass:"chat-msg-text",domProps:{innerHTML:e._s(e.$emo.transform(e.msgInfo.content))}}):e._e(),1==e.msgInfo.type?t("div",{staticClass:"chat-msg-image"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"img-load-box",attrs:{"element-loading-text":"上传中..","element-loading-background":"rgba(0, 0, 0, 0.4)"}},[t("img",{staticClass:"send-image",attrs:{src:JSON.parse(e.msgInfo.content).thumbUrl},on:{click:function(t){return e.showFullImageBox()}}})]),t("span",{directives:[{name:"show",rawName:"v-show",value:e.loadFail,expression:"loadFail"}],staticClass:"send-fail el-icon-warning",attrs:{title:"发送失败"},on:{click:e.handleSendFail}})]):e._e(),2==e.msgInfo.type?t("div",{staticClass:"chat-msg-file"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"chat-file-box"},[t("div",{staticClass:"chat-file-info"},[t("el-link",{staticClass:"chat-file-name",attrs:{underline:!0,target:"_blank",type:"primary",href:e.data.url}},[e._v(e._s(e.data.name))]),t("div",{staticClass:"chat-file-size"},[e._v(e._s(e.fileSize))])],1),e._m(0)]),t("span",{directives:[{name:"show",rawName:"v-show",value:e.loadFail,expression:"loadFail"}],staticClass:"send-fail el-icon-warning",attrs:{title:"发送失败"},on:{click:e.handleSendFail}})]):e._e(),3==e.msgInfo.type?t("div",{staticClass:"chat-msg-voice",on:{click:function(t){return e.handlePlayVoice()}}},[t("audio",{attrs:{controls:"",src:JSON.parse(e.msgInfo.content).url}})]):e._e()])])]),t("right-menu",{directives:[{name:"show",rawName:"v-show",value:e.menu&&e.rightMenu.show,expression:"menu && rightMenu.show"}],attrs:{pos:e.rightMenu.pos,items:e.menuItems},on:{close:function(t){e.rightMenu.show=!1},select:e.handleSelectMenu}})],1)},O=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"chat-file-icon"},[t("span",{staticClass:"el-icon-document",attrs:{type:"primary"}})])}],N=function(){var e=this,t=e._self._c;return t("div",{staticClass:"right-menu-mask",on:{click:function(t){return e.close()},contextmenu:function(t){return t.preventDefault(),e.close()}}},[t("div",{staticClass:"right-menu",style:{left:e.pos.x+"px",top:e.pos.y+"px"}},[t("el-menu",{attrs:{"background-color":"#f5f5f5","text-color":"#333333"}},e._l(e.items,(function(s){return t("el-menu-item",{key:s.key,attrs:{title:s.name},on:{click:function(t){return e.handleSelectMenu(s)}}},[t("i",{class:s.icon}),t("span",[e._v(e._s(s.name))])])})),1)],1)])},$=[],R={name:"rightMenu",data(){return{}},props:{pos:{type:Object},items:{type:Array}},methods:{close(){this.$emit("close")},handleSelectMenu(e){this.$emit("select",e)}}},B=R,A=(s("9f20"),Object(u["a"])(B,N,$,!1,null,null,null)),E=A.exports,D={name:"messageItem",components:{ChatTime:m,HeadImage:p["a"],RightMenu:E},props:{mine:{type:Boolean,required:!0},headImage:{type:String,required:!0},showName:{type:String,required:!0},msgInfo:{type:Object,required:!0},menu:{type:Boolean,default:!0}},data(){return{audioPlayState:"STOP",rightMenu:{show:!1,pos:{x:0,y:0}}}},methods:{handleSendFail(){this.$message.error("该文件已发送失败，目前不支持自动重新发送，建议手动重新发送")},showFullImageBox(){let e=JSON.parse(this.msgInfo.content).originUrl;e&&this.$store.commit("showFullImageBox",e)},handlePlayVoice(){this.audio||(this.audio=new Audio),this.audio.src=JSON.parse(this.msgInfo.content).url,this.audio.play(),this.handlePlayVoice="RUNNING"},showRightMenu(e){this.rightMenu.pos={x:e.x,y:e.y},this.rightMenu.show="true"},handleSelectMenu(e){this.$emit(e.key.toLowerCase(),this.msgInfo)}},computed:{loading(){return this.msgInfo.loadStatus&&"loading"===this.msgInfo.loadStatus},loadFail(){return this.msgInfo.loadStatus&&"fail"===this.msgInfo.loadStatus},data(){return JSON.parse(this.msgInfo.content)},fileSize(){let e=this.data.size;return e>1048576?Math.round(e/1024/1024)+"M":e>1024?Math.round(e/1024)+"KB":e+"B"},menuItems(){let e=[];return e.push({key:"DELETE",name:"删除",icon:"el-icon-delete"}),this.msgInfo.selfSend&&this.msgInfo.id>0&&e.push({key:"RECALL",name:"撤回",icon:"el-icon-refresh-left"}),e}},mounted(){}},U=D,j=(s("7496"),Object(u["a"])(U,P,O,!1,null,null,null)),F=j.exports,L=s("1a05"),G=function(){var e=this,t=e._self._c;return t("div",{staticClass:"emotion-mask",on:{click:function(t){return e.$emit("emotion","")}}},[t("div",{staticClass:"emotion-box",style:{left:e.x+"px",top:e.y+"px"}},[t("el-scrollbar",{staticStyle:{height:"200px"}},[t("div",{staticClass:"emotion-item-list"},e._l(e.$emo.emoTextList,(function(s,i){return t("div",{key:i,staticClass:"emotion-item",domProps:{innerHTML:e._s(e.$emo.textToImg(s))},on:{click:function(t){return e.clickHandler(s)}}})})),0)])],1)])},V=[],z={name:"emotion",props:{pos:{type:Object}},data(){return{}},methods:{clickHandler(e){let t=`#${e};`;this.$emit("emotion",t)}},computed:{x(){return this.pos.x-200},y(){return this.pos.y-230}}},H=z,J=(s("b263"),Object(u["a"])(H,G,V,!1,null,"4ee8d7cc",null)),W=J.exports,q=function(){var e=this,t=e._self._c;return t("el-dialog",{staticClass:"chat-voice",attrs:{title:"语音录制",visible:e.visible,width:"600px","before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[t("div",{directives:[{name:"show",rawName:"v-show",value:"RECORD"==e.mode,expression:"mode=='RECORD'"}]},[t("div",{staticClass:"chat-voice-tip"},[e._v(e._s(e.stateTip))]),t("div",[e._v("时长: "+e._s("STOP"==e.state?0:parseInt(e.rc.duration))+"s")])]),t("audio",{directives:[{name:"show",rawName:"v-show",value:"PLAY"==e.mode,expression:"mode=='PLAY'"}],ref:"audio",attrs:{src:e.url,controls:""},on:{ended:function(t){return e.handleStopAudio()}}}),t("el-divider",{attrs:{"content-position":"center"}}),t("el-row",{staticClass:"chat-voice-btn-group"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:"STOP"==e.state,expression:"state=='STOP'"}],attrs:{round:"",type:"primary"},on:{click:function(t){return e.handleStartRecord()}}},[e._v("开始录音")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:"RUNNING"==e.state,expression:"state=='RUNNING'"}],attrs:{round:"",type:"warning"},on:{click:function(t){return e.handlePauseRecord()}}},[e._v("暂停录音")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:"PAUSE"==e.state,expression:"state=='PAUSE'"}],attrs:{round:"",type:"primary"},on:{click:function(t){return e.handleResumeRecord()}}},[e._v("继续录音")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:"RUNNING"==e.state||"PAUSE"==e.state,expression:"state=='RUNNING'||state=='PAUSE'"}],attrs:{round:"",type:"danger"},on:{click:function(t){return e.handleCompleteRecord()}}},[e._v(" 结束录音")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:"COMPLETE"==e.state&&"PLAY"!=e.mode,expression:"state=='COMPLETE' && mode!='PLAY'"}],attrs:{round:"",type:"success"},on:{click:function(t){return e.handlePlayAudio()}}},[e._v("播放录音 ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:"COMPLETE"==e.state&&"PLAY"==e.mode,expression:"state=='COMPLETE' && mode=='PLAY'"}],attrs:{round:"",type:"warning"},on:{click:function(t){return e.handleStopAudio()}}},[e._v("停止播放 ")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:"COMPLETE"==e.state,expression:"state=='COMPLETE'"}],attrs:{round:"",type:"primary"},on:{click:function(t){return e.handleRestartRecord()}}},[e._v("重新录音")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:"COMPLETE"==e.state,expression:"state=='COMPLETE'"}],attrs:{round:"",type:"primary"},on:{click:function(t){return e.handleSendRecord()}}},[e._v("立即发送")])],1)],1)},Y=[],Q=s("da43"),K=s.n(Q),X={name:"chatVoice",props:{visible:{type:Boolean}},data(){return{rc:new K.a,audio:new Audio,state:"STOP",stateTip:"未开始",mode:"RECORD",duration:0,url:""}},methods:{handleClose(){this.rc.destroy(),this.rc=new K.a,this.audio.pause(),this.mode="RECORD",this.state="STOP",this.stateTip="未开始",this.$emit("close")},handleStartRecord(){this.rc.start().then(e=>{this.state="RUNNING",this.stateTip="正在录音..."}).catch(e=>{console.log(e),this.$message.error(e),console.log(e)})},handlePauseRecord(){this.rc.pause(),this.state="PAUSE",this.stateTip="已暂停录音"},handleResumeRecord(){this.rc.resume(),this.state="RUNNING",this.stateTip="正在录音..."},handleCompleteRecord(){this.rc.pause(),this.state="COMPLETE",this.stateTip="已结束录音"},handlePlayAudio(){let e=this.rc.getWAVBlob(),t=URL.createObjectURL(e);this.$refs.audio.src=t,this.$refs.audio.play(),this.mode="PLAY"},handleStopAudio(){console.log(this.$refs.audio),this.$refs.audio.pause(),this.mode="RECORD"},handleRestartRecord(){this.rc.destroy(),this.rc=new K.a,this.rc.start(),this.state="RUNNING",this.mode="RECORD",this.stateTip="正在录音..."},handleSendRecord(){let e=this.rc.getWAVBlob(),t=(new Date).getDate()+".wav";var s=new window.FormData;s.append("file",e,t),this.$http({url:"/file/upload",data:s,method:"post",headers:{"Content-Type":"multipart/form-data"}}).then(e=>{let t={duration:parseInt(this.rc.duration),url:e};this.$emit("send",t),this.handleClose()})}}},Z=X,ee=(s("8b70"),Object(u["a"])(Z,q,Y,!1,null,null,null)),te=ee.exports,se=function(){var e=this,t=e._self._c;return t("el-drawer",{attrs:{title:"聊天历史记录",size:"700px",visible:e.visible,direction:"rtl","before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"chat-history",attrs:{"element-loading-text":"拼命加载中"}},[t("el-scrollbar",{ref:"scrollbar",staticClass:"chat-history-scrollbar",attrs:{id:"historyScrollbar"}},[t("ul",e._l(e.messages,(function(s,i){return t("li",{key:i},[t("chat-message-item",{attrs:{mine:s.sendId==e.mine.id,headImage:e.headImage(s),showName:e.showName(s),msgInfo:s,menu:!1}})],1)})),0)])],1)])},ie=[],ne={name:"chatHistory",components:{ChatMessageItem:F},props:{visible:{type:Boolean},chat:{type:Object},friend:{type:Object},group:{type:Object},groupMembers:{type:Array}},data(){return{page:1,size:10,messages:[],loadAll:!1,loading:!1,lastScrollTime:new Date}},methods:{handleClose(){this.page=1,this.messages=[],this.loadAll=!1,this.$emit("close")},handleScroll(){let e=this.$refs.scrollbar.$refs.wrap.scrollTop,t=(new Date).getTime()-this.lastScrollTime.getTime();e<30&&t>500&&(this.lastScrollTime=new Date,this.loadMessages())},loadMessages(){if(this.loadAll)return this.$message.success("已到达顶部");let e={page:this.page++,size:this.size};"GROUP"==this.chat.type?e.groupId=this.group.id:e.friendId=this.friend.id,this.loading=!0,this.$http({url:this.histroyAction,method:"get",params:e}).then(e=>{e.forEach(e=>this.messages.unshift(e)),this.loading=!1,e.length<this.size&&(this.loadAll=!0),this.refreshScrollPos()}).catch(()=>{this.loading=!1})},showName(e){if("GROUP"==this.chat.type){let t=this.groupMembers.find(t=>t.userId==e.sendId);return t?t.aliasName:""}return e.sendId==this.mine.id?this.mine.nickName:this.chat.showName},headImage(e){if("GROUP"==this.chat.type){let t=this.groupMembers.find(t=>t.userId==e.sendId);return t?t.headImage:""}return e.sendId==this.mine.id?this.mine.headImageThumb:this.chat.headImage},refreshScrollPos(){let e=this.$refs.scrollbar.$refs.wrap,t=e.scrollHeight,s=e.scrollTop;this.$nextTick(()=>{let i=e.scrollHeight-t;e.scrollTop=s+i,e.scrollHeight==t&&this.loadMessages()})}},computed:{mine(){return this.$store.state.userStore.userInfo},histroyAction(){return`/message/${this.chat.type.toLowerCase()}/history`}},watch:{visible:{handler(e,t){e&&(this.loadMessages(),this.$nextTick(()=>{document.getElementById("historyScrollbar").addEventListener("mousewheel",this.handleScroll,!0)}))}}}},ae=ne,oe=(s("9da1"),Object(u["a"])(ae,se,ie,!1,null,null,null)),re=oe.exports,le={name:"chatPrivate",components:{ChatMessageItem:F,FileUpload:L["a"],ChatGroupSide:_,Emotion:W,ChatVoice:te,ChatHistory:re},props:{chat:{type:Object}},data(){return{friend:{},group:{},groupMembers:[],sendText:"",showVoice:!1,showSide:!1,showEmotion:!1,emoBoxPos:{x:0,y:0},showHistory:!1,lockMessage:!1}},methods:{handleImageSuccess(e,t){let s=JSON.parse(JSON.stringify(t.raw.msgInfo));s.content=JSON.stringify(e.data),this.$http({url:this.messageAction,method:"post",data:s}).then(e=>{s.loadStatus="ok",s.id=e,this.$store.commit("insertMessage",s)})},handleImageFail(e,t){let s=JSON.parse(JSON.stringify(t.raw.msgInfo));s.loadStatus="fail",this.$store.commit("insertMessage",s)},handleImageBefore(e){let t=URL.createObjectURL(e),s={originUrl:t,thumbUrl:t},i={id:0,fileId:e.uid,sendId:this.mine.id,content:JSON.stringify(s),sendTime:(new Date).getTime(),selfSend:!0,type:1,loadStatus:"loading"};this.setTargetId(i,this.chat.targetId),this.$store.commit("insertMessage",i),this.scrollToBottom(),e.msgInfo=i},handleFileSuccess(e,t){let s={name:t.name,size:t.size,url:e.data},i=JSON.parse(JSON.stringify(t.raw.msgInfo));i.content=JSON.stringify(s),this.$http({url:this.messageAction,method:"post",data:i}).then(e=>{i.loadStatus="ok",i.id=e,this.$store.commit("insertMessage",i)})},handleFileFail(e,t){let s=JSON.parse(JSON.stringify(t.raw.msgInfo));s.loadStatus="fail",this.$store.commit("insertMessage",s)},handleFileBefore(e){let t=URL.createObjectURL(e),s={name:e.name,size:e.size,url:t},i={id:0,sendId:this.mine.id,content:JSON.stringify(s),sendTime:(new Date).getTime(),selfSend:!0,type:2,loadStatus:"loading"};this.setTargetId(i,this.chat.targetId),this.$store.commit("insertMessage",i),this.scrollToBottom(),e.msgInfo=i},handleCloseSide(){this.showSide=!1},switchEmotionBox(){this.showEmotion=!this.showEmotion;let e=this.$refs.emotion.offsetWidth,t=this.$elm.fixLeft(this.$refs.emotion),s=this.$elm.fixTop(this.$refs.emotion);this.emoBoxPos.y=s,this.emoBoxPos.x=t+e/2},handleEmotion(e){this.sendText+=e,this.showEmotion=!1,this.$refs.sendBox.focus()},showVoiceBox(){this.showVoice=!0},closeVoiceBox(){this.showVoice=!1},showVideoBox(){console.log(this.friend),this.$store.commit("showChatPrivateVideoBox",{friend:this.friend,master:!0})},showHistoryBox(){this.showHistory=!0},closeHistoryBox(){this.showHistory=!1},handleSendVoice(e){let t={content:JSON.stringify(e),type:3};this.setTargetId(t,this.chat.targetId),this.$http({url:this.messageAction,method:"post",data:t}).then(e=>{this.$message.success("发送成功"),t.id=e,t.sendTime=(new Date).getTime(),t.sendId=this.$store.state.userStore.userInfo.id,t.selfSend=!0,this.$store.commit("insertMessage",t),this.$refs.sendBox.focus(),this.scrollToBottom(),this.showVoice=!1})},setTargetId(e,t){"GROUP"==this.chat.type?e.groupId=t:e.recvId=t},sendTextMessage(){if(!this.sendText.trim())return void this.$message.error("不能发送空白信息");let e={content:this.sendText,type:0};this.setTargetId(e,this.chat.targetId),this.lockMessage=!0,this.$http({url:this.messageAction,method:"post",data:e}).then(t=>{this.$message.success("发送成功"),this.sendText="",e.id=t,e.sendTime=(new Date).getTime(),e.sendId=this.$store.state.userStore.userInfo.id,e.selfSend=!0,this.$store.commit("insertMessage",e)}).finally(()=>{this.lockMessage=!1,this.$nextTick(()=>this.$refs.sendBox.focus()),this.scrollToBottom()});const t=window.event||arguments[0];return"Enter"===t.key||"Enter"===t.code||13===t.keyCode?(t.returnValue=!1,t.preventDefault(),!1):void 0},deleteMessage(e){this.$confirm("确认删除消息?","删除消息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.commit("deleteMessage",e)})},recallMessage(e){this.$confirm("确认撤回消息?","撤回消息",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{let t=`/message/${this.chat.type.toLowerCase()}/recall/${e.id}`;this.$http({url:t,method:"delete"}).then(()=>{this.$message.success("消息已撤回"),e=JSON.parse(JSON.stringify(e)),e.type=10,e.content="你撤回了一条消息",this.$store.commit("insertMessage",e)})})},loadGroup(e){this.$http({url:"/group/find/"+e,method:"get"}).then(e=>{this.group=e,this.$store.commit("updateChatFromGroup",e),this.$store.commit("updateGroup",e)}),this.$http({url:"/group/members/"+e,method:"get"}).then(e=>{this.groupMembers=e})},loadFriend(e){this.$http({url:"/user/find/"+e,method:"get"}).then(e=>{this.friend=e,console.log(this.friend),this.$store.commit("updateChatFromFriend",e),this.$store.commit("updateFriend",e)})},showName(e){if("GROUP"==this.chat.type){let t=this.groupMembers.find(t=>t.userId==e.sendId);return t?t.aliasName:""}return e.sendId==this.mine.id?this.mine.nickName:this.chat.showName},headImage(e){if("GROUP"==this.chat.type){let t=this.groupMembers.find(t=>t.userId==e.sendId);return t?t.headImage:""}return e.sendId==this.mine.id?this.mine.headImageThumb:this.chat.headImage},scrollToBottom(){this.$nextTick(()=>{const e=document.getElementById("chatScrollBox");e.scrollTop=e.scrollHeight})}},computed:{mine(){return this.$store.state.userStore.userInfo},title(){let e=this.chat.showName;if("GROUP"==this.chat.type){let t=this.groupMembers.filter(e=>!e.quit).length;e+=`(${t})`}return e},imageAction(){return"/api/image/upload"},fileAction(){return"/api/file/upload"},messageAction(){return`/message/${this.chat.type.toLowerCase()}/send`}},watch:{chat:{handler(e,t){e.targetId>0&&(!t||e.type!=t.type||e.targetId!=t.targetId)&&("GROUP"==this.chat.type?this.loadGroup(this.chat.targetId):this.loadFriend(this.chat.targetId),this.scrollToBottom(),this.sendText="",this.$nextTick(()=>{this.$refs.sendBox.focus()}))},immediate:!0}}},ce=le,de=(s("5a39"),Object(u["a"])(ce,w,b,!1,null,null,null)),ue=de.exports,he={name:"chat",components:{ChatItem:y,ChatBox:ue},data(){return{searchText:"",messageContent:"",group:{},groupMembers:[]}},methods:{handleActiveItem(e){this.$store.commit("activeChat",e)},handleDelItem(e,t){this.$store.commit("removeChat",t)}},computed:{chatStore(){return this.$store.state.chatStore},activeChat(){let e=this.chatStore.activeIndex,t=this.chatStore.chats;if(e>=0&&t.length>0)return t[e];let s={targetId:-1,showName:"",headImage:"",messages:[]};return s}}},me=he,pe=(s("eba8"),Object(u["a"])(me,i,n,!1,null,null,null));t["default"]=pe.exports},4177:function(e,t,s){},4841:function(e,t,s){},"5a39":function(e,t,s){"use strict";s("3646")},7496:function(e,t,s){"use strict";s("f217")},7560:function(e,t,s){},"8b70":function(e,t,s){"use strict";s("dac6")},"9da1":function(e,t,s){"use strict";s("9f9e")},"9f20":function(e,t,s){"use strict";s("d35c")},"9f9e":function(e,t,s){},a1ce:function(e,t,s){},ad9a:function(e,t,s){
/*!
 * 
 * js-audio-recorder - js audio recorder plugin
 * 
 * @version v1.0.7
 * @homepage https://github.com/2fps/recorder
 * @author 2fps <echoweb@126.com> (https://www.zhuyuntao.cn)
 * @license MIT
 *         
 */
!function(t,s){e.exports=s()}(0,(function(){return function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=1)}([function(e,t,s){"use strict";function i(e,t,s){for(var i=0;i<s.length;i++)e.setUint8(t+i,s.charCodeAt(i))}Object.defineProperty(t,"__esModule",{value:!0}),t.compress=function(e,t,s){for(var i=t/s,n=Math.max(i,1),a=e.left,o=e.right,r=Math.floor((a.length+o.length)/i),l=new Float32Array(r),c=0,d=0;c<r;){var u=Math.floor(d);l[c]=a[u],c++,o.length&&(l[c]=o[u],c++),d+=n}return l},t.encodePCM=function(e,t,s){void 0===s&&(s=!0);var i=0,n=e.length*(t/8),a=new ArrayBuffer(n),o=new DataView(a);if(8===t)for(var r=0;r<e.length;r++,i++){var l=(c=Math.max(-1,Math.min(1,e[r])))<0?128*c:127*c;l=+l+128,o.setInt8(i,l)}else for(r=0;r<e.length;r++,i+=2){var c=Math.max(-1,Math.min(1,e[r]));o.setInt16(i,c<0?32768*c:32767*c,s)}return o},t.encodeWAV=function(e,t,s,n,a,o){void 0===o&&(o=!0);var r=s>t?t:s,l=a,c=new ArrayBuffer(44+e.byteLength),d=new DataView(c),u=n,h=0;i(d,h,"RIFF"),h+=4,d.setUint32(h,36+e.byteLength,o),i(d,h+=4,"WAVE"),i(d,h+=4,"fmt "),h+=4,d.setUint32(h,16,o),h+=4,d.setUint16(h,1,o),h+=2,d.setUint16(h,u,o),h+=2,d.setUint32(h,r,o),h+=4,d.setUint32(h,u*r*(l/8),o),h+=4,d.setUint16(h,u*(l/8),o),h+=2,d.setUint16(h,l,o),i(d,h+=2,"data"),h+=4,d.setUint32(h,e.byteLength,o),h+=4;for(var m=0;m<e.byteLength;)d.setUint8(h,e.getUint8(m)),h++,m++;return d}},function(e,t,s){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])})(e,t)},function(e,t){function s(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)});Object.defineProperty(t,"__esModule",{value:!0});var a=s(2),o=s(0),r=s(3),l=function(e){function t(t){void 0===t&&(t={});var s=e.call(this,t)||this;return s.isrecording=!1,s.ispause=!1,s.isplaying=!1,s}return n(t,e),t.prototype.setOption=function(e){void 0===e&&(e={}),this.setNewOption(e)},t.prototype.start=function(){return this.isrecording?Promise.reject():(this.isrecording=!0,this.startRecord())},t.prototype.pause=function(){this.isrecording&&!this.ispause&&(this.ispause=!0,this.pauseRecord())},t.prototype.resume=function(){this.isrecording&&this.ispause&&(this.ispause=!1,this.resumeRecord())},t.prototype.stop=function(){this.isrecording&&(this.isrecording=!1,this.ispause=!1,this.stopRecord())},t.prototype.play=function(){this.stop(),this.isplaying=!0,this.onplay&&this.onplay(),r.default.addPlayEnd(this.onplayend);var e=this.getWAV();e.byteLength>44&&r.default.play(e.buffer)},t.prototype.getPlayTime=function(){return r.default.getPlayTime()},t.prototype.pausePlay=function(){!this.isrecording&&this.isplaying&&(this.isplaying=!1,this.onpauseplay&&this.onpauseplay(),r.default.pausePlay())},t.prototype.resumePlay=function(){this.isrecording||this.isplaying||(this.isplaying=!0,this.onresumeplay&&this.onresumeplay(),r.default.resumePlay())},t.prototype.stopPlay=function(){this.isrecording||(this.isplaying=!1,this.onstopplay&&this.onstopplay(),r.default.stopPlay())},t.prototype.destroy=function(){return r.default.destroyPlay(),this.destroyRecord()},t.prototype.getRecordAnalyseData=function(){return this.getAnalyseData()},t.prototype.getPlayAnalyseData=function(){return r.default.getAnalyseData()},t.prototype.getPCM=function(){this.stop();var e=this.getData();return e=o.compress(e,this.inputSampleRate,this.outputSampleRate),o.encodePCM(e,this.oututSampleBits,this.littleEdian)},t.prototype.getPCMBlob=function(){return new Blob([this.getPCM()])},t.prototype.downloadPCM=function(e){void 0===e&&(e="recorder");var t=this.getPCMBlob();a.downloadPCM(t,e)},t.prototype.getWAV=function(){var e=this.getPCM();return o.encodeWAV(e,this.inputSampleRate,this.outputSampleRate,this.config.numChannels,this.oututSampleBits,this.littleEdian)},t.prototype.getWAVBlob=function(){return new Blob([this.getWAV()],{type:"audio/wav"})},t.prototype.downloadWAV=function(e){void 0===e&&(e="recorder");var t=this.getWAVBlob();a.downloadWAV(t,e)},t.prototype.download=function(e,t,s){a.download(e,t,s)},t.prototype.getChannelData=function(){var e=this.getPCM(),t=e.byteLength,s=this.littleEdian,i={left:null,right:null};if(2===this.config.numChannels){var n=new DataView(new ArrayBuffer(t/2)),a=new DataView(new ArrayBuffer(t/2));if(16===this.config.sampleBits)for(var o=0;o<t/2;o+=2)n.setInt16(o,e.getInt16(2*o,s),s),a.setInt16(o,e.getInt16(2*o+2,s),s);else for(o=0;o<t/2;o+=2)n.setInt8(o,e.getInt8(2*o)),a.setInt8(o,e.getInt8(2*o+1));i.left=n,i.right=a}else i.left=e;return i},t}(s(5).default);t.default=l},function(e,t,s){"use strict";function i(e,t,s){var i=document.createElement("a");i.href=window.URL.createObjectURL(e),i.download=t+"."+s,i.click()}Object.defineProperty(t,"__esModule",{value:!0}),t.downloadWAV=function(e,t){void 0===t&&(t="recorder"),i(e,t,"wav")},t.downloadPCM=function(e,t){void 0===t&&(t="recorder"),i(e,t,"pcm")},t.download=function(e,t,s){return i(e,t,s)}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(4),n=null,a=0,o=0,r=null,l=null,c=null,d=!1,u=0,h=function(){};function m(){return d=!1,r.decodeAudioData(c.slice(0),(function(e){(n=r.createBufferSource()).onended=function(){d||(u=r.currentTime-o+a,h())},n.buffer=e,n.connect(l),l.connect(r.destination),n.start(0,a),o=r.currentTime}),(function(e){i.throwError(e)}))}function p(){n&&(n.stop(),n=null)}var f=function(){function e(){}return e.play=function(e){return r||(r=new(window.AudioContext||window.webkitAudioContext),(l=r.createAnalyser()).fftSize=2048),this.stopPlay(),c=e,u=0,m()},e.pausePlay=function(){p(),a+=r.currentTime-o,d=!0},e.resumePlay=function(){return m()},e.stopPlay=function(){a=0,c=null,p()},e.destroyPlay=function(){this.stopPlay()},e.getAnalyseData=function(){var e=new Uint8Array(l.frequencyBinCount);return l.getByteTimeDomainData(e),e},e.addPlayEnd=function(e){void 0===e&&(e=function(){}),h=e},e.getPlayTime=function(){var e=d?a:r.currentTime-o+a;return u||e},e}();t.default=f},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.throwError=function(e){throw new Error(e)}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(0),n=function(){function e(t){void 0===t&&(t={}),this.size=0,this.lBuffer=[],this.rBuffer=[],this.tempPCM=[],this.inputSampleBits=16,this.fileSize=0,this.duration=0,this.needRecord=!0;var s,i=new(window.AudioContext||window.webkitAudioContext);this.inputSampleRate=i.sampleRate,this.setNewOption(t),this.littleEdian=(s=new ArrayBuffer(2),new DataView(s).setInt16(0,256,!0),256===new Int16Array(s)[0]),e.initUserMedia()}return e.prototype.setNewOption=function(e){void 0===e&&(e={}),this.config={sampleBits:~[8,16].indexOf(e.sampleBits)?e.sampleBits:16,sampleRate:~[8e3,11025,16e3,22050,24e3,44100,48e3].indexOf(e.sampleRate)?e.sampleRate:this.inputSampleRate,numChannels:~[1,2].indexOf(e.numChannels)?e.numChannels:1},this.outputSampleRate=this.config.sampleRate,this.oututSampleBits=this.config.sampleBits},e.prototype.startRecord=function(){var e=this;return this.context&&this.destroyRecord(),this.initRecorder(),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){e.audioInput=e.context.createMediaStreamSource(t),e.stream=t})).then((function(){e.audioInput.connect(e.analyser),e.analyser.connect(e.recorder),e.recorder.connect(e.context.destination)}))},e.prototype.pauseRecord=function(){this.needRecord=!1},e.prototype.resumeRecord=function(){this.needRecord=!0},e.prototype.stopRecord=function(){this.audioInput&&this.audioInput.disconnect(),this.source&&this.source.stop(),this.recorder.disconnect(),this.analyser.disconnect(),this.needRecord=!0},e.prototype.destroyRecord=function(){return this.clearRecordStatus(),this.stopStream(),this.closeAudioContext()},e.prototype.getAnalyseData=function(){var e=new Uint8Array(this.analyser.frequencyBinCount);return this.analyser.getByteTimeDomainData(e),e},e.prototype.getData=function(){return this.flat()},e.prototype.clearRecordStatus=function(){this.lBuffer.length=0,this.rBuffer.length=0,this.size=0,this.fileSize=0,this.PCM=null,this.audioInput=null,this.duration=0},e.prototype.flat=function(){var e=null,t=new Float32Array(0);1===this.config.numChannels?e=new Float32Array(this.size):(e=new Float32Array(this.size/2),t=new Float32Array(this.size/2));for(var s=0,i=0;i<this.lBuffer.length;i++)e.set(this.lBuffer[i],s),s+=this.lBuffer[i].length;for(s=0,i=0;i<this.rBuffer.length;i++)t.set(this.rBuffer[i],s),s+=this.rBuffer[i].length;return{left:e,right:t}},e.prototype.initRecorder=function(){var e=this;this.clearRecordStatus(),this.context=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.context.createAnalyser(),this.analyser.fftSize=2048;var t=this.context.createScriptProcessor||this.context.createJavaScriptNode;this.recorder=t.apply(this.context,[4096,this.config.numChannels,this.config.numChannels]),this.recorder.onaudioprocess=function(t){if(e.needRecord){var s,i=t.inputBuffer.getChannelData(0),n=null;e.lBuffer.push(new Float32Array(i)),e.size+=i.length,2===e.config.numChannels&&(n=t.inputBuffer.getChannelData(1),e.rBuffer.push(new Float32Array(n)),e.size+=n.length),e.fileSize=Math.floor(e.size/Math.max(e.inputSampleRate/e.outputSampleRate,1))*(e.oututSampleBits/8),s=100*Math.max.apply(Math,i),e.duration+=4096/e.inputSampleRate,e.onprocess&&e.onprocess(e.duration),e.onprogress&&e.onprogress({duration:e.duration,fileSize:e.fileSize,vol:s})}}},e.prototype.stopStream=function(){this.stream&&this.stream.getTracks&&(this.stream.getTracks().forEach((function(e){return e.stop()})),this.stream=null)},e.prototype.closeAudioContext=function(){return this.context&&this.context.close&&"closed"!==this.context.state?this.context.close():new Promise((function(e){e()}))},e.initUserMedia=function(){void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((function(s,i){t.call(navigator,e,s,i)})):Promise.reject(new Error("浏览器不支持 getUserMedia !"))})},e.prototype.transformIntoPCM=function(e,t){var s=new Float32Array(e),n=new Float32Array(t),a=i.compress({left:s,right:n},this.inputSampleRate,this.outputSampleRate);return i.encodePCM(a,this.oututSampleBits,this.littleEdian)},e.getPermission=function(){return this.initUserMedia(),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){e&&e.getTracks().forEach((function(e){return e.stop()}))}))},e}();t.default=n}]).default}))},ae09:function(e,t,s){"use strict";s("4177")},b242:function(e,t,s){"use strict";var i=function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"邀请好友",visible:e.visible,width:"50%","before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[t("div",{staticClass:"agm-container"},[t("div",{staticClass:"agm-l-box"},[t("el-input",{staticClass:"input-with-select",attrs:{width:"200px",placeholder:"搜索好友"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch()}},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){return e.handleSearch()}},slot:"append"})],1),t("el-scrollbar",{staticStyle:{height:"400px"}},e._l(e.friends,(function(s,i){return t("div",{key:s.id},[t("friend-item",{directives:[{name:"show",rawName:"v-show",value:s.nickName.startsWith(e.searchText),expression:"friend.nickName.startsWith(searchText)"}],attrs:{showDelete:!1,friend:s,index:i,active:i===e.activeIndex},nativeOn:{click:function(t){return e.handleSwitchCheck(s)}}},[t("el-checkbox",{staticClass:"agm-friend-checkbox",attrs:{disabled:s.disabled,size:"medium"},nativeOn:{click:function(e){e.stopPropagation()}},model:{value:s.isCheck,callback:function(t){e.$set(s,"isCheck",t)},expression:"friend.isCheck"}})],1)],1)})),0)],1),t("div",{staticClass:"agm-r-box"},[t("div",{staticClass:"agm-select-tip"},[e._v(" 已勾选"+e._s(e.checkCount)+"位好友")]),t("el-scrollbar",{staticStyle:{height:"400px"}},e._l(e.friends,(function(s,i){return t("div",{key:s.id},[s.isCheck&&!s.disabled?t("friend-item",{attrs:{friend:s,index:i,active:!1},on:{del:function(t){return e.handleRemoveFriend(s,i)}}}):e._e()],1)})),0)],1)]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){return e.handleClose()}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleOk()}}},[e._v("确 定")])],1)])},n=[],a=s("ff36"),o={name:"addGroupMember",components:{FriendItem:a["a"]},data(){return{searchText:"",activeIndex:-1,friends:[]}},methods:{handleClose(){this.$emit("close")},handleOk(){let e={groupId:this.groupId,friendIds:[]};this.friends.forEach(t=>{t.isCheck&&!t.disabled&&e.friendIds.push(t.id)}),e.friendIds.length>0&&this.$http({url:"/group/invite",method:"post",data:e}).then(()=>{this.$message.success("邀请成功"),this.$emit("reload"),this.$emit("close")})},handleRemoveFriend(e,t){e.isCheck=!1},handleSwitchCheck(e){e.disabled||(e.isCheck=!e.isCheck)}},props:{visible:{type:Boolean},groupId:{type:Number},members:{type:Array}},computed:{checkCount(){return this.friends.filter(e=>e.isCheck&&!e.disabled).length}},watch:{visible:function(e,t){e&&(this.friends=[],this.$store.state.friendStore.friends.forEach(e=>{let t=JSON.parse(JSON.stringify(e)),s=this.members.filter(e=>!e.quit).find(t=>t.userId==e.id);console.log(s),s?(t.disabled=!0,t.isCheck=!0):(t.disabled=!1,t.isCheck=!1),this.friends.push(t)}))}}},r=o,l=(s("ae09"),s("2877")),c=Object(l["a"])(r,i,n,!1,null,null,null);t["a"]=c.exports},b263:function(e,t,s){"use strict";s("7560")},b557:function(e,t,s){"use strict";s("a1ce")},d35c:function(e,t,s){},da43:function(e,t,s){e.exports=s("ad9a")},dac6:function(e,t,s){},de5e:function(e,t,s){"use strict";s("4841")},eba8:function(e,t,s){"use strict";s("3270")},f217:function(e,t,s){},ff36:function(e,t,s){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"friend-item",class:e.active?"active":""},[t("div",{staticClass:"avatar"},[t("head-image",{attrs:{url:e.friend.headImage}})],1),t("div",{staticClass:"text"},[t("div",[e._v(e._s(e.friend.nickName))]),t("div",{class:e.online?"online-status  online":"online-status"},[e._v(e._s(e.online?"[在线]":"[离线]"))])]),e.showDelete?t("div",{staticClass:"close",on:{click:function(t){return t.stopPropagation(),e.handleDel()}}},[t("i",{staticClass:"el-icon-close",staticStyle:{border:"none","font-size":"20px",color:"black"},attrs:{title:"添加好友"}})]):e._e(),e._t("default")],2)},n=[],a=s("4036"),o={name:"frinedItem",components:{HeadImage:a["a"]},data(){return{}},methods:{handleDel(){console.log("11111111111111111111"),this.$emit("del",this.friend,this.index)}},props:{friend:{type:Object},active:{type:Boolean},index:{type:Number},showDelete:{type:Boolean,default:!0}},computed:{online(){return this.$store.state.friendStore.friends[this.index].online}}},r=o,l=(s("35fb"),s("2877")),c=Object(l["a"])(r,i,n,!1,null,null,null);t["a"]=c.exports}}]);
//# sourceMappingURL=chunk-3420c764.0299d3bf.js.map